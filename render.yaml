services:
  # Single Service - Backend + Frontend
  - type: web
    name: videoconference-app
    env: node
    plan: starter
    buildCommand: |
      echo "==> Current directory: $(pwd)"
      echo "==> Building server..."
      cd server && npm ci && npm run build && cd ..
      echo "==> Building client..."
      cd client && npm ci && npm run build && cd ..
      echo "==> Copying client build to server public directory..."
      mkdir -p server/dist/public
      cp -rv client/dist/* server/dist/public/
      echo "==> Verifying files were copied..."
      ls -la server/dist/public/
      echo "==> Build complete!"
    startCommand: cd server && npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        generateValue: true
      - key: CORS_ORIGIN
        value: "*"
      - key: RATE_LIMIT_WINDOW_MS
        value: "900000"
      - key: RATE_LIMIT_MAX_REQUESTS
        value: "100"
      - key: DATA_DIR
        value: "/var/data"
      - key: ADMIN_EMAIL
        value: "admin@example.com"
      - key: ADMIN_PASSWORD
        generateValue: true
    disk:
      name: videoconference-data
      mountPath: /var/data
      sizeGB: 1

databases: []